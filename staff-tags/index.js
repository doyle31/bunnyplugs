(function(x,f,s,d,E,p,g,v,S){"use strict";const{Permissions:A}=d.constants,{computePermissions:_}=s.findByProps("computePermissions","canEveryoneRole"),u=s.findByStoreName("GuildMemberStore"),B=[d.i18n.Messages.AI_TAG,d.i18n.Messages.BOT_TAG_BOT,d.i18n.Messages.BOT_TAG_SERVER,d.i18n.Messages.SYSTEM_DM_TAG_SYSTEM,d.i18n.Messages.GUILD_AUTOMOD_USER_BADGE_TEXT,d.i18n.Messages.REMIXING_TAG],b=[{text:"WEBHOOK",condition:function(e,r,t){return t.isNonUserBot()}},{text:"OWNER",condition:function(e,r,t){return e?.ownerId===t.id}},{text:"ADMIN",permissions:["ADMINISTRATOR"]},{text:"MOD",permissions:["MANAGE_GUILD","MANAGE_CHANNELS","MANAGE_ROLES","MANAGE_WEBHOOKS"]},{text:"STAFF",permissions:["MANAGE_MESSAGES","KICK_MEMBERS","BAN_MEMBERS"]},{text:"VC Mod",permissions:["MOVE_MEMBERS","MUTE_MEMBERS","DEAFEN_MEMBERS"]},{text:"Chat Mod",permissions:["MODERATE_MEMBERS"]}],T=[{text:"WEBHOOK",condition:function(e,r,t){return t.isNonUserBot()}},{text:"OWNER",condition:function(e,r,t){return e?.ownerId===t.id}},{text:"SUDOER",condition:function(e,r,t){return u.getMember(e?.id,t.id)?.roles?.includes("399814854413647884")}},{text:"OPERATOR",backgroundColor:"#ff0000",condition:function(e,r,t){return u.getMember(e?.id,t.id)?.roles?.includes("716842288831004718")}},{text:"SYSOP",condition:function(e,r,t){return u.getMember(e?.id,t.id)?.roles?.includes("1434955221502787775")}},{text:"MOD",condition:function(e,r,t){return u.getMember(e?.id,t.id)?.roles?.includes("399818870568779776")}},{text:"TU",condition:function(e,r,t){return u.getMember(e?.id,t.id)?.roles?.includes("406212176164945922")}},{text:"HU",condition:function(e,r,t){return u.getMember(e?.id,t.id)?.roles?.includes("461957316921524254")}},{text:"VC Mod",permissions:["MOVE_MEMBERS","MUTE_MEMBERS","DEAFEN_MEMBERS"]},{text:"Chat Mod",permissions:["MODERATE_MEMBERS"]}];function R(e,r,t){let l;if(e){const o=_({user:t,context:e,overwrites:r?.permissionOverwrites});l=Object.entries(A).map(function([n,c]){return o&c?n:""}).filter(Boolean)}if(e?.id=="399812551963049995"){for(const o of T)if(o.condition?.(e,r,t)||!t.bot&&o.permissions?.some(function(n){return l?.includes(n)})){let n=f.storage.useRoleColor?u.getMember(e?.id,t.id)?.colorString:void 0,c=n||(o.backgroundColor??p.rawColors.BRAND_500),i=n||!o.textColor?d.chroma(c).get("lab.l")<70?p.rawColors.WHITE_500:p.rawColors.BLACK_500:o.textColor;return{...o,textColor:i,backgroundColor:c,verified:typeof o.verified=="function"?o.verified(e,r,t):o.verified??!1,condition:void 0,permissions:void 0}}}else for(const o of b)if(o.condition?.(e,r,t)||!t.bot&&o.permissions?.some(function(n){return l?.includes(n)})){let n=f.storage.useRoleColor?u.getMember(e?.id,t.id)?.colorString:void 0,c=n||(o.backgroundColor??p.rawColors.BRAND_500),i=n||!o.textColor?d.chroma(c).get("lab.l")<70?p.rawColors.WHITE_500:p.rawColors.BLACK_500:o.textColor;return{...o,textColor:i,backgroundColor:c,verified:typeof o.verified=="function"?o.verified(e,r,t):o.verified??!1,condition:void 0,permissions:void 0}}}const N=s.findByName("getTagProperties",!1),O=s.findByStoreName("GuildStore"),m=s.findByStoreName("ChannelStore");function I(){return E.after("default",N,function([{message:e}],r){if(!B.includes(r.tagText)){const t=m.getChannel(e.channel_id),l=O.getGuild(t?.guild_id),o=R(l,t,e.author);if(o)return{...r,tagText:o.text,tagTextColor:o.textColor?d.ReactNative.processColor(d.chroma(o.textColor).hex()):void 0,tagBackgroundColor:o.backgroundColor?d.ReactNative.processColor(d.chroma(o.backgroundColor).hex()):void 0,tagVerified:o.verified,tagType:void 0}}})}const y=s.findByProps("getBotLabel"),G=y?.getBotLabel,D=s.findByStoreName("GuildStore"),k=function([{guildId:e,user:r}],t){const l=t?.props?.label,o=g.findInReactTree(l,function(a){return Array.isArray(a?.props?.children)&&a.props.children.some(function(C){return typeof C=="string"||typeof C?.props?.children=="string"})}),n=g.findInReactTree(o,function(a){return a?.type?.Types});if(n){const a=G?.(n.props.type);if(B.includes(a))return}const c=D.getGuild(e),i=R(c,void 0,r);i&&(n?Object.assign(n.props,{type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified}):(Array.isArray(o.props.children)||(o.props.children=[o.props.children]),o.props.children.push(React.createElement(y.default,{type:0,text:i.text,textColor:i.textColor,backgroundColor:i.backgroundColor,verified:i.verified}))))};function w(){const e=[];return s.findByTypeNameAll("UserRow").forEach(function(r){return e.push(E.after("type",r,k))}),function(){return e.forEach(function(r){return r()})}}const U=s.findByName("DisplayName",!1),L=s.findByName("HeaderName",!1),h=s.findByProps("getBotLabel"),P=h.getBotLabel,$=s.findByStoreName("GuildStore"),H=s.findByStoreName("ChannelStore");function V(){const e=[];return e.push(E.after("default",L,function([{channelId:r}],t){t.props.channelId=r})),e.push(E.after("default",U,function([{guildId:r,channelId:t,user:l}],o){const n=g.findInReactTree(o,function(c){return c.type.Types});if(!n||!B.includes(P(n.props.type))){const c=$.getGuild(r),i=H.getChannel(t),a=R(c,i,l);a&&(n?n.props={type:0,...a}:g.findInReactTree(o,function(C){return C.props.style.flexDirection==="row"}).props.children.push(React.createElement(h.default,{style:{marginLeft:0},type:0,text:a.text,textColor:a.textColor,backgroundColor:a.backgroundColor,verified:a.verified})))}})),function(){return e.forEach(function(r){return r()})}}const F=s.findByProps("getBotLabel");function K(){return E.after("default",F,function([{text:e,textColor:r,backgroundColor:t}],l){const o=g.findInReactTree(l,function(n){return typeof n.props.children=="string"});e&&(o.props.children=e),r&&o.props.style.push({color:r}),t&&l.props.style.push({backgroundColor:t})})}const{ScrollView:W}=S.General,{FormSection:j,FormSwitchRow:Y}=S.Forms;function X(){return v.useProxy(f.storage),React.createElement(W,{style:{flex:1}},React.createElement(j,{title:"Tag style"},React.createElement(Y,{label:"Use top role color for tag backgrounds",value:f.storage.useRoleColor,onValueChange:function(e){f.storage.useRoleColor=e}})))}let M=[];var q={onLoad:function(){f.storage.useRoleColor??=!1,M.push(I()),M.push(K()),M.push(V()),M.push(w())},onUnload:function(){return M.forEach(function(e){return e()})},settings:X};return x.default=q,Object.defineProperty(x,"__esModule",{value:!0}),x})({},vendetta.plugin,vendetta.metro,vendetta.metro.common,vendetta.patcher,vendetta.ui,vendetta.utils,vendetta.storage,vendetta.ui.components);
